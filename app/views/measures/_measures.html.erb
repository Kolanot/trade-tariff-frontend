<div class="js-tabs nav-tabs">
  <ul>
    <li class='active'>
      <a href="#overview">Overview</a>
    </li>
    <li>
      <a href="#import">Import</a>
    </li>
    <li>
      <a href="#export">Export</a>
    </li>
    <li>
      <a href="#notes">Chapter notes</a>
    </li>
  </ul>
</div>





<% # Overview tab %>
<div class="js-tab-content tab-content">
  <article class="js-tab-pane tab-pane active" id="overview">
    <%= render partial: 'declarables/consigned', locals: { declarable: declarable } %>
    <%= render partial: 'declarables/filtered', locals: { search: @search } %>
    <div class="inner">
      <h1 class="visuallyhidden">Overview</h1>
      <div class="grid-row import-and-export-boxes">
      <div class="column-one-half">
      <div class="import box">
          <h2 class="heading-medium">Import</h2>
          <p>The commodity code for importing is <strong><%= declarable.code %></strong>.</p>
          <% if declarable.basic_duty_rate.present? %>
            <p>Importing from outside the EU is subject to a third country duty of <strong><%= declarable.basic_duty_rate.html_safe %></strong> unless subject to other measures. <a href="#">What does this mean?</a></p>
          <% else %>
            <p>Importing from outside the EU is subject to <strong>variable</strong> third country duty.</p>
          <% end %>
          <p> Import measures and restrictions for specific countries can be found under the <a href="#import">import</a> tab.</p>
          <% declarable.import_measures.vat.national.each do |measure| %>
            <p>Goods are subject to <%= measure.measure_type.description %>.</p>
          <% end %>
        </div>
      </div>

      <div class="column-one-half">
        <div class="export box">
          <h2 class="heading-medium">Export</h2>
          <p>The commodity code for exporting and intrastat reporting is <strong><%= declarable.display_export_code %></strong>.</p>

            <p>Export measures and restrictions for specific countries can be found under the <a href="#export">export</a> tab.</p>
        </div>
      </div>
    </div>
    <nav class="part-pagination return-to-top">
      <a href="#wrapper">Return to top &uarr;</a>
    </nav>
    <% if declarable.footnote.present? %>
      <table class="tariff-zebra small-table">
        <caption class="heading-medium">Commodity footnotes</caption>
        <thead>
          <tr>
            <th scope="col">Code</th>
            <th scope="col">Description</th>
          </tr>
        </thead>
        <tbody>
            <%= render declarable.footnote %>
        </tbody>
      </table>
    <% end %>
    <% if declarable.meursing_code? %>
      <h2 class="heading-medium">This commodity has a meursing code</h2>
      <p>Use the <%= link_to "Look up Meursing code", "https://www.gov.uk/additional-commodity-code", rel: "external", target: "_blank", title: "Opens in a new window" %> tool to find the additional code required for importing and exporting. To calculate the duty rate, enter the meursing code (without the 7 at the start) into the <%= link_to "meursing calculator", declarable.meursing_tool_link_for(@search.date.to_taric_date), rel: "external", target: "_blank", title: "Opens in a new window" %>.</p>
    <% end %>
    <h2 class="heading-medium">Binding tariff information</h2>
    <p>You can search the EU EBTI-database for existing <%= link_to "Binding Tariff Information", declarable.bti_url, rel: "external", target: "_blank", title: "Opens in a new window" %> for commodity code <strong><%= declarable.code %></strong>.</p>
  </article>





<% # Import tab %>
  <article class="js-tab-pane tab-pane" id="import" data-id="<%= declarable.to_param %>" data-class="<%=declarable.class.name.downcase.pluralize %>">

    <h2 class="heading-medium">Import measures and restrictions</h2>
    <%= render partial: 'declarables/consigned', locals: { declarable: declarable } %>
    <%= render partial: 'declarables/filtered', locals: { search: @search } %>

    <table class="tariff-zebra small-table third-country">
      <caption class="heading-small">Third country measures:</caption>
      <thead>
        <tr>
          <th scope="col">&nbsp;</th>
          <th scope="col">Measure type</th>
          <th scope="col">Start &amp; end dates</th>
          <th scope="col">Duty rates &amp; supplementary units</th>
          <th scope="col">Additional codes</th>
          <th scope="col">Conditions</th>
          <th scope="col">Exclusions</th>
          <th scope="col" class="legal-act external-link" title="Opens in a new window">Council Regulation (EEC)</th>
          <th scope="col">Footnote</th>
        </tr>
      </thead>
      <tbody>
        <% if @search.filtered_by_country? %>
          <%= render partial: "measures/measure", collection: declarable.import_measures.for_all_countries.reject{|m| m.excludes_country?(@search.country)}.sort_by(&:sort_key), locals: { declarable: declarable } %>
        <% else %>
          <%= render partial: "measures/measure", collection: declarable.import_measures.for_all_countries.sort_by(&:sort_key), locals: { declarable: declarable } %>
        <% end %>
      </tbody>
    </table>

    <% if @search.filtered_by_country? %>
      <table class="tariff-zebra small-table country-filter">
        <caption class="heading-small">Measures specific to <%= @search.country_name %>:</caption>
        <thead>
          <tr>
            <th>&nbsp;</th>
            <th>Country</th>
            <th>Measure type</th>
            <th>Start &amp; end dates</th>
            <th>Duty rates &amp; supplementary units</th>
            <th>Additional codes</th>
            <th>Conditions</th>
            <th>Exclusions</th>
            <th class="legal-act external-link" title="Opens in a new window">Council Regulation (EEC)</th>
            <th>Footnotes</th>
          </tr>
        </thead>

        <tbody>
        <% if declarable.import_measures.except(:third_country).for_country(@search.country).any? %>
          <%= render partial: "measures/measure", collection: declarable.import_measures.except(:third_country).for_country(@search.country).sort_by(&:specific_country_sort_key) %>
        <% else %>
          <tr>
            <td><span class="flag eu"></span></td>
            <td colspan="9">There are no EU preference measures for this commodity on this date</td>
          </tr>
        <% end %>
        </tbody>
      </table>
    <% end %>

    <table class="tariff-zebra small-table specific-countries">
      <caption class="heading-small">
        <% if @search.filtered_by_country? %>
          Measures for other countries and country groups:
        <% else %>
          Measures for specific countries and country groups:
        <% end %>
      </caption>
      <thead>
        <tr>
          <th>&nbsp;</th>
          <th>Country</th>
          <th>Measure type</th>
          <th>Start &amp; end dates</th>
          <th>Duty rates &amp; supplementary units</th>
          <th>Additional codes</th>
          <th>Conditions</th>
          <th>Exclusions</th>
          <th class="legal-act external-link" title="Opens in a new window">Council Regulation (EEC)</th>
          <th>Footnotes</th>
        </tr>
      </thead>
      <tbody>
      <% if declarable.import_measures.for_specific_countries.any? %>
        <% if @search.filtered_by_country? %>
          <%= render partial: "measures/measure", collection: declarable.import_measures.for_specific_countries.reject{|m| m.relevant_for_country?(@search.country) }.sort_by(&:specific_country_sort_key), locals: { declarable: declarable } %>
        <% else %>
          <%= render partial: "measures/measure", collection: declarable.import_measures.for_specific_countries.sort_by(&:specific_country_sort_key), locals: { declarable: declarable } %>
        <% end %>
      <% else %>
        <tr>
          <td><span class="flag eu"></span></td>
          <td colspan="9">There are no EU preference measures for this commodity on this date</td>
        </tr>
      <% end %>
      </tbody>
    </table>
    <nav class="part-pagination return-to-top">
      <a href="#wrapper">Return to top &uarr;</a>
    </nav>
  </article><!-- end .tab-pane -->





<% # Export tab %>
  <article class="js-tab-pane tab-pane" id="export" data-id="<%= declarable.to_param %>" data-class="<%=declarable.class.name.downcase.pluralize %>">

    <h2 class="heading-medium">Export measures and restrictions</h2>
    <%= render partial: 'declarables/consigned', locals: { declarable: declarable } %>
    <%= render partial: 'declarables/filtered', locals: { search: @search } %>

    <table class="tariff-zebra small-table third-country">
      <caption class="heading-small">Third country measures:</caption>
      <thead>
        <tr>
          <th scope="col">&nbsp;</th>
          <th scope="col">Measure type</th>
          <th scope="col">Start &amp; end dates</th>
          <th scope="col">Duty rates &amp; supplementary units</th>
          <th scope="col">Additional codes</th>
          <th scope="col">Conditions</th>
          <th scope="col">Exclusions</th>
          <th scope="col" class="legal-act external-link" title="Opens in a new window">Council Regulation (EEC)</th>
          <th scope="col">Footnote</th>
        </tr>
      </thead>
      <tbody>
      <% if declarable.export_measures.for_all_countries.any? %>
        <% if @search.filtered_by_country? %>
          <%= render partial: "measures/measure", collection: declarable.export_measures.for_all_countries.reject{|m| m.excludes_country?(@search.country)}.sort_by(&:sort_key), locals: { declarable: declarable } %>
        <% else %>
          <%= render partial: "measures/measure", collection: declarable.export_measures.for_all_countries.sort_by(&:sort_key), locals: { declarable: declarable } %>
        <% end %>
      <% else %>
        <tr>
          <td><span class="flag eu"></span></td>
          <td colspan="8">There are no EU third country measures for this commodity on this date</td>
        </tr>
      <% end %>
      <% unless declarable.export_measures.for_all_countries.vat.any? %>
        <tr>
          <td><span class="flag uk"></span></td>
          <td colspan="8">No VAT or Excise measures were found for this commodity on this date</td>
        </tr>
      <% end %>
      </tbody>
    </table>

    <% if @search.filtered_by_country? %>
      <table class="tariff-zebra small-table country-filter">
        <caption class="heading-small">Measures specific to <%= @search.country_name %>:</caption>
        <thead>
          <tr>
            <th>&nbsp;</th>
            <th>Country</th>
            <th>Measure type</th>
            <th>Start &amp; end dates</th>
            <th>Duty rates &amp; supplementary units</th>
            <th>Additional codes</th>
            <th>Conditions</th>
            <th>Exclusions</th>
            <th class="legal-act external-link" title="Opens in a new window">Council Regulation (EEC)</th>
            <th>Footnotes</th>
          </tr>
        </thead>

        <tbody>
        <% if declarable.export_measures.except(:third_country).for_country(@search.country).any? %>
          <%= render partial: "measures/measure", collection: declarable.export_measures.except(:third_country).for_country(@search.country).sort_by(&:specific_country_sort_key) %>
        <% else %>
          <tr>
            <td><span class="flag eu"></span></td>
            <td colspan="9">There are no EU preference measures for this commodity on this date</td>
          </tr>
        <% end %>
        </tbody>
      </table>
    <% end %>

    <table class="tariff-zebra small-table specific-countries">
      <caption class="heading-small">
        <% if @search.filtered_by_country? %>
          Measures for other countries and country groups:
        <% else %>
          Measures for specific countries and country groups:
        <% end %>
      </caption>
      <thead>
        <tr>
          <th>&nbsp;</th>
          <th>Country</th>
          <th>Measure type</th>
          <th>Start &amp; end dates</th>
          <th>Duty rates &amp; supplementary units</th>
          <th>Additional codes</th>
          <th>Conditions</th>
          <th>Exclusions</th>
          <th class="legal-act external-link" title="Opens in a new window">Council Regulation (EEC)</th>
          <th>Footnotes</th>
        </tr>
      </thead>

      <tbody>
      <% if declarable.export_measures.for_specific_countries.any? %>
        <% if @search.filtered_by_country? %>
          <%= render partial: "measures/measure", collection: declarable.export_measures.for_specific_countries.reject{|m| m.relevant_for_country?(@search.country) }.sort_by(&:specific_country_sort_key), locals: { declarable: declarable } %>
        <% else %>
          <%= render partial: "measures/measure", collection: declarable.export_measures.for_specific_countries.sort_by(&:specific_country_sort_key), locals: { declarable: declarable } %>
        <% end %>
      <% else %>
        <tr>
          <td><span class="flag eu"></span></td>
          <td colspan="9">There are no EU preference measures for this commodity on this date</td>
        </tr>
      <% end %>
      </tbody>
    </table>
    <nav class="part-pagination return-to-top">
      <a href="#wrapper">Return to top &uarr;</a>
    </nav>
  </article><!-- end .tab-pane -->





<% # Notes tab %>
  <article class="tab-pane" id="notes" data-id="<%= declarable.to_param %>" data-class="<%=declarable.class.name.downcase.pluralize %>">
    <h2 class="heading-medium">Chapter notes</h2>
    <%= render 'shared/notes', section_note: declarable.section.section_note, chapter_note: declarable.chapter.chapter_note %>
    <nav class="part-pagination return-to-top">
      <a href="#wrapper">Return to top &uarr;</a>
    </nav>
  </article><!-- end .tab-pane -->




<span style="display: none;">
  <div class="inner">
    <%= render partial: "measures/measure_references", collection: declarable.import_measures.for_all_countries, as: 'measure' %>
    <%= render partial: "measures/measure_references", collection: declarable.import_measures.for_specific_countries, as: 'measure' %>
  </div>
  <div class="inner">
    <%= render partial: "measures/measure_references", collection: declarable.export_measures.for_all_countries, as: 'measure' %>
    <%= render partial: "measures/measure_references", collection: declarable.export_measures.for_specific_countries, as: 'measure' %>
  </div>
  </span>
</div><!-- end .tab-content -->
