<div class='browse-sections core-content group'>
  <nav>
    <ul>
      <li>
        <strong>Back to</strong>:
        <%= link_to "All Sections", sections_path %>
      </li>
      <li>
        <strong>Section</strong>:
        <%= link_to @section, section_path(@section) %>
      </li>
      <li>
        <strong>Chapter</strong>:
        <%= link_to @chapter, chapter_path(@chapter) %>
      </li>
      <li>
        <strong>Heading</strong>:
        <%= link_to @heading, heading_path(@heading) %>
      </li>
    </ul>
  </nav>

  <div class='commodity'>
    <h3><%= @commodity.long_desc %></h3>
  </div>

  <hr/>

  <h2>Third country measures</h2>
  <table>
    <thead>
      <tr>
        <th>Measure Type</th>
        <th>Duty rates / prohibitions</th>
        <th>Additional codes</th>
        <th>Conditions</th>
        <th>Exclusions</th>
        <th>Legal Act</th>
        <th>Footnote</th>
      </tr>
    </thead>
    <tbody>
      <% @commodity.measures.select{|m| m.region.present? }.each do |measure| %>
        <tr>
          <td><%= measure.measure_type %></td>
          <td><%= measure.duty_rates %></td>
          <td><%= measure.additional_codes.map(&:code).join(", ") %></td>
          <td>
            <% measure.conditions.each do |condition| %>
              <div id='condition-<%= condition.id %>' class='modal hide'>
                <div class="modal-header">
                  <a href='' class="close no-pjax" data-dismiss="modal">Ã—</a>
                  <h3><%= condition.document_code %></h3>
                </div>
                <div class="modal-body">
                  <table>
                    <thead>
                      <tr>
                        <th>Code</th>
                        <th>Action</th>
                        <th>Requirement</th>
                        <th>Duty Expression</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><%= condition.document_code %></td>
                        <td><%= condition.action %></td>
                        <td><%= condition.requirement %></td>
                        <td><%= condition.duty_expression %></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div class="modal-footer">
                  <a href="#" data-dismiss="modal" class="btn no-pjax">Close</a>
                </div>
              </div>
              <%= link_to condition.document_code, '', 'class' => 'no-pjax', 'data-toggle' => 'modal', 'data-backdrop' => 'false', 'data-target' => "#condition-#{condition.id}" %>
            <% end %>
          </td>
          <td><%= measure.excluded_countries.map(&:name).join(", ") %></td>
          <td><%= link_to measure.legal_act.code, measure.legal_act.url if measure.legal_act.present? %></td>
          <td>
            <% measure.footnotes.each do |footnote| %>
              <a href='' ref='popover' data-placement='left' title='<%= footnote.code %>' data-content="<%= footnote.description %>" class='no-pjax region'>
                <%= footnote.code %>
              </a>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <hr/>

  <h2>Measures for specific countries and country groups</h2>
  <table>
    <thead>
      <tr>
        <th>Country</th>
        <th>Measure Type</th>
        <th>Duty rates / prohibitions</th>
        <th>Additional codes</th>
        <th>Conditions</th>
        <th>Exclusions</th>
        <th>Legal Act</th>
        <th>Footnote</th>
      </tr>
    </thead>
    <tbody>
      <% @commodity.measures.select{|m| m.region.blank? }.each do |measure| %>
        <tr>
          <td>
            <% if measure.region.country_group?  %>
              <a href='' ref='popover' title='<%= measure.region.description %>' data-content="<%= measure.region.country_names %>" class='no-pjax region'>
                <%= measure.region %>
              </a>
            <% else %>
              <%= measure.region %>
            <% end %>
          </td>
          <td><%= measure.measure_type %></td>
          <td><%= measure.duty_rates %></td>
          <td><%= measure.additional_codes.map(&:code).join(", ") %></td>
          <td><%= measure.conditions.map(&:document_code).join(", ") %></td>
          <td><%= measure.excluded_countries.map(&:name).join(", ") %></td>
          <td><%= link_to measure.legal_act.code, measure.legal_act.url if measure.legal_act.present? %></td>
          <td>
            <% measure.footnotes.each do |footnote| %>
              <a href='' ref='popover' data-placement='left' title='<%= footnote.code %>' data-content="<%= footnote.description %>" class='region no-pjax'>
                <%= footnote.code %>
              </a>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
